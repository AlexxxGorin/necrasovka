# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

## üìã –û–±–∑–æ—Ä

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –±—ã–ª–∏ –≤—ã—è–≤–ª–µ–Ω—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –û—à–∏–±–∫–∞ `vite: not found` –≤ Frontend

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ —Å–±–æ—Ä–∫–µ Docker –æ–±—Ä–∞–∑–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
sh: vite: not found
```

**–ü—Ä–∏—á–∏–Ω–∞**: –í `Dockerfile.frontend` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –∫–æ–º–∞–Ω–¥–∞ `npm ci --only=production`, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∞ dev-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –≤–∫–ª—é—á–∞—è `vite`.

**–†–µ—à–µ–Ω–∏–µ**:
```dockerfile
# –ë—ã–ª–æ:
RUN npm ci --only=production

# –°—Ç–∞–ª–æ:
RUN npm ci
RUN npm run build
RUN rm -rf node_modules  # –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–∞
```

### 2. –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Nginx

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ —Å–±–æ—Ä–∫–µ Docker –æ–±—Ä–∞–∑–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
group 'nginx' in use
```

**–ü—Ä–∏—á–∏–Ω–∞**: –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã `nginx`, –∫–æ—Ç–æ—Ä–∞—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–æ–≤–æ–º –æ–±—Ä–∞–∑–µ.

**–†–µ—à–µ–Ω–∏–µ**: –£–¥–∞–ª–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≥—Ä—É–ø–ø—ã, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `nginx` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
```dockerfile
# –£–¥–∞–ª–µ–Ω–æ:
# RUN addgroup -g 101 -S nginx
# RUN adduser -S -D -H -u 101 -h /var/cache/nginx -s /sbin/nologin -G nginx -g nginx nginx

# –î–æ–±–∞–≤–ª–µ–Ω–æ:
RUN chown -R nginx:nginx /usr/share/nginx/html /var/cache/nginx /var/run /var/log/nginx
```

### 3. –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø–æ—Ä—Ç–æ–≤ (80, 8080)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Ä—Ç—ã 80 –∏ 8080 –±—ã–ª–∏ –∑–∞–Ω—è—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```
failed to bind host port: address already in use
```

**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω —É–º–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–∏—Å–∫–∞ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤:

#### 3.1 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ—Ä—Ç–æ–≤
–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `deploy/smart-deploy.sh`:
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–æ—Ä—Ç–∞ –Ω–∞—á–∏–Ω–∞—è —Å 3000
find_free_port() {
    local port=3000
    while ss -tuln | grep -q ":$port "; do
        ((port++))
        if [ $port -gt 9999 ]; then
            echo "–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Å–≤–æ–±–æ–¥–Ω—ã–π –ø–æ—Ä—Ç –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 3000-9999" >&2
            return 1
        fi
    done
    echo $port
}
```

#### 3.2 –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker Compose
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ docker-compose.smart.yml —Å –Ω—É–∂–Ω—ã–º –ø–æ—Ä—Ç–æ–º
cp docker-compose.simple.yml docker-compose.smart.yml
sed -i "s/3000:80/$APP_PORT:80/g" docker-compose.smart.yml
```

### 4. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —É–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:

#### 4.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Docker
```bash
check_docker() {
    if ! systemctl is-active --quiet docker; then
        echo "[WARNING] Docker –Ω–µ –∑–∞–ø—É—â–µ–Ω. –ó–∞–ø—É—Å–∫–∞–µ–º..."
        systemctl start docker
        sleep 5
    fi
}
```

#### 4.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ —Å–±–æ—Ä–∫–∏
if ! docker-compose -f "$COMPOSE_FILE" build; then
    echo "[ERROR] ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑—ã"
    exit 1
fi
```

#### 4.3 Health check –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
if curl -f -s "http://localhost:$APP_PORT/health" > /dev/null; then
    echo "[SUCCESS] ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ health check"
else
    echo "[WARNING] ‚ö†Ô∏è –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ health check"
fi
```

## üöÄ –ò—Ç–æ–≥–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### 1. `deploy/smart-deploy.sh` - –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ô
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–æ—Ä—Ç–∞
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker Compose
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞

### 2. `deploy/fix-and-deploy.sh` - –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–´–ô
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–∏
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ Health check –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### 3. `deploy/full-deploy.sh` - –ë–ê–ó–û–í–´–ô
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è + —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
- ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

## üßπ –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

–£–¥–∞–ª–µ–Ω—ã —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

### –£–¥–∞–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ~~`Dockerfile`~~ ‚Üí –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `Dockerfile.backend`
- ~~`docker-compose.yml`~~ ‚Üí –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `docker-compose.prod.yml`
- ~~`docker-compose.smart.yml`~~ ‚Üí –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª (—Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
- ~~`PORT_FIX_SUMMARY.md`~~ ‚Üí –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞ –≤ —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç
- ~~`SEARCH_MODES.md`~~ ‚Üí –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- ~~`test_search_modes.py`~~ ‚Üí –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
- ~~`deploy/check-ports.sh`~~ ‚Üí —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≤–∫–ª—é—á–µ–Ω–∞ –≤ `smart-deploy.sh`
- ~~`deploy/test-local-build.sh`~~ ‚Üí —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≤–∫–ª—é—á–µ–Ω–∞ –≤ `fix-and-deploy.sh`
- ~~`frontend/frontend-necrasovka/vite.config.prod.js`~~ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–æ–π `vite.config.js`

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `deploy/check-deployment.sh`:
–£–¥–∞–ª–µ–Ω—ã —Å—Å—ã–ª–∫–∏ –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã, –æ–±–Ω–æ–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫.

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

### ‚úÖ –£—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ:
- **–ê–¥—Ä–µ—Å**: http://89.169.3.47:3000
- **API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: http://89.169.3.47:3000/docs
- **Health check**: http://89.169.3.47:3000/health
- **–ê–≤—Ç–æ—Ç–µ—Å—Ç—ã**: http://89.169.3.47:3000/test-search

### ‚úÖ –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã:
1. **Frontend —Å–±–æ—Ä–∫–∞** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
2. **Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. **–ü–æ—Ä—Ç—ã** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∞–≤—Ç–æ–ø–æ–∏—Å–∫ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
5. **–û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞** - —É–¥–∞–ª–µ–Ω—ã —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ñ–∞–π–ª—ã

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –Ω–æ–≤—ã—Ö —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π:
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–º–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
./deploy/smart-deploy.sh 89.169.3.47 root
```

### –î–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
./deploy/check-deployment.sh

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
./deploy/monitor.sh --health
```

### –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:
```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –æ—Ç–∫–∞—Ç–æ–º
./deploy/update.sh 89.169.3.47 root
```

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Ä–µ—à–µ–Ω—ã. –ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–æ–∏—Å–∫–æ–º –ø–æ—Ä—Ç–æ–≤, —É–ª—É—á—à–µ–Ω–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π –∏ –æ—á–∏—â–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —Ñ–∞–π–ª–æ–≤.

**üéâ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ!**
